-- Delta Aimlock — Merebennie Final Build (Delta Mobile Executor, UI Resilient, No FOV Camera Change, No FPS Booster)
-- Designed for Delta Mobile Executor compatibility
-- UI-only, NO FOV camera changer, NO FPS booster

-- ======= SERVICES =======
local Players          = game:GetService("Players")
local RunService       = game:GetService("RunService")
local TweenService     = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local SoundService     = game:GetService("SoundService")
local Workspace        = game:GetService("Workspace")
local CoreGui          = game:GetService("CoreGui")

local Camera = Workspace.CurrentCamera

-- ======= SAFETY WAIT =======
local LocalPlayer = Players.LocalPlayer
while not LocalPlayer do task.wait(0.05); LocalPlayer = Players.LocalPlayer end
local PlayerGui = LocalPlayer:FindFirstChild("PlayerGui")
while not PlayerGui do task.wait(0.05); PlayerGui = LocalPlayer:FindFirstChild("PlayerGui") end

-- ======= HELPERS =======
local function safeNew(className)
    local ok, inst = pcall(function() return Instance.new(className) end)
    if ok then return inst end
    return nil
end

local function safeParent(obj, parent)
    if obj and parent then
        pcall(function() obj.Parent = parent end)
    end
end

local function newSound(id)
    local s = safeNew("Sound")
    if not s then return nil end
    s.SoundId = id or ""
    s.Volume = 1
    safeParent(s, SoundService)
    return s
end

-- ======= CONFIG =======
local CFG = {
    LOCK_PART  = "Head",
    AIM_MODE   = "Smooth", -- "Smooth" | "Snap"
    SMOOTHING  = 0.35,
    USE_CAM_HEIGHT = true,
    CAM_HEIGHT     = 2,
    SCREEN_TILT    = -5,
    CLICK_SOUND_ID = "rbxassetid://6042053626",
    USE_PREDICTION = true,
    BULLET_SPEED   = 1400, -- internal (not exposed)
    SPAWN_MARKER_SIZE = Vector3.new(4, 0.2, 4),
}

-- ======= STATE =======
local aiming = false
local targetPart = nil
local targetHRP = nil
local spawnPointCFrame = nil
local spawnMarker = nil

-- ======= SOUNDS =======
local clickSound = newSound(CFG.CLICK_SOUND_ID)

-- ======= GUI CREATION (parent to CoreGui for Delta, fallback to PlayerGui) =======
local function parentGuiSafe(gui)
    local success = pcall(function()
        gui.Parent = CoreGui
    end)
    if not success or not gui.Parent then
        local plrGui = LocalPlayer:FindFirstChild("PlayerGui") or LocalPlayer:WaitForChild("PlayerGui", 2)
        if plrGui then
            gui.Parent = plrGui
        else
            warn("[DeltaAim] Could not parent GUI to CoreGui or PlayerGui.")
        end
    end
end

local gui = safeNew("ScreenGui")
if not gui then error("Failed to create ScreenGui") end
gui.Name = "Merebennie_DeltaAim_UI"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
parentGuiSafe(gui)

LocalPlayer.CharacterAdded:Connect(function()
    if not gui.Parent then
        parentGuiSafe(gui)
    end
end)

task.spawn(function()
    while task.wait(2) do
        if not gui.Parent then
            parentGuiSafe(gui)
        end
    end
end)

-- UI helpers
local function applyTextStyle(lbl, size, bold, color)
    if not lbl then return end
    lbl.BackgroundTransparency = 1
    lbl.Font = bold and Enum.Font.GothamBold or Enum.Font.Gotham
    lbl.TextSize = size or 14
    lbl.TextColor3 = color or Color3.new(1,1,1)
    lbl.TextStrokeColor3 = Color3.new(0,0,0)
    lbl.TextStrokeTransparency = 0.15
end

local function makeRound(obj, radius)
    local c = safeNew("UICorner")
    c.CornerRadius = UDim.new(0, radius or 8)
    safeParent(c, obj)
end

local function addStroke(obj, thickness, color)
    local s = safeNew("UIStroke")
    s.Thickness = thickness or 1
    s.Color = color or Color3.fromRGB(0,0,0)
    safeParent(s, obj)
end

local function addGradient(obj, color1, color2, rotation)
    local g = safeNew("UIGradient")
    g.Color = ColorSequence.new{ColorSequenceKeypoint.new(0, color1), ColorSequenceKeypoint.new(1, color2)}
    if rotation then g.Rotation = rotation end
    safeParent(g, obj)
end

local function tween(instance, props, time, style, dir)
    local t = TweenService:Create(instance, TweenInfo.new(time or 0.18, style or Enum.EasingStyle.Quad, dir or Enum.EasingDirection.Out), props)
    t:Play()
    return t
end

-- ======= WATERMARK =======
local watermark = safeNew("TextLabel")
watermark.Name = "Watermark"
watermark.Size = UDim2.new(0, 220, 0, 20)
watermark.Position = UDim2.new(0, 8, 0, 8)
watermark.AnchorPoint = Vector2.new(0,0)
watermark.BackgroundTransparency = 1
watermark.Font = Enum.Font.Arcade
watermark.TextSize = 16
watermark.Text = "Made by Merebennie"
applyTextStyle(watermark, 16, true, Color3.new(1,1,1))
safeParent(watermark, gui)

-- ======= MAIN FRAME =======
local mainFrame = safeNew("Frame")
mainFrame.Size = UDim2.new(0, 360, 0, 140)
mainFrame.Position = UDim2.new(0.5, -180, 0.12, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0)
mainFrame.BackgroundTransparency = 0
safeParent(mainFrame, gui)
makeRound(mainFrame, 14)
addStroke(mainFrame, 1)
addGradient(mainFrame, Color3.fromRGB(18,24,35), Color3.fromRGB(28,48,78), 90)

local title = safeNew("TextLabel")
title.Size = UDim2.new(0.7, -20, 0, 32)
title.Position = UDim2.new(0, 12, 0, 8)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Text = "Aimlock Controller"
applyTextStyle(title, 18, true)
safeParent(title, mainFrame)

-- Settings gear
local settingsBtn = safeNew("TextButton")
settingsBtn.Size = UDim2.new(0, 36, 0, 36)
settingsBtn.Position = UDim2.new(1, -12, 0, 8)
settingsBtn.AnchorPoint = Vector2.new(1,0)
settingsBtn.Text = "⚙"
applyTextStyle(settingsBtn, 18, true)
settingsBtn.BackgroundTransparency = 0
safeParent(settingsBtn, mainFrame)
makeRound(settingsBtn, 12); addStroke(settingsBtn, 1); addGradient(settingsBtn, Color3.fromRGB(220,230,255), Color3.fromRGB(190,200,230), 180)

-- ======= MAIN INDICATOR (70x70) =======
local mainIndicator = safeNew("Frame")
mainIndicator.Name = "MainIndicator"
mainIndicator.Size = UDim2.new(0, 70, 0, 70)
mainIndicator.Position = UDim2.new(0.03, 0, 0.5, 0)
mainIndicator.AnchorPoint = Vector2.new(0, 0.5)
mainIndicator.BackgroundTransparency = 0
safeParent(mainIndicator, mainFrame)
makeRound(mainIndicator, 12); addStroke(mainIndicator, 1); addGradient(mainIndicator, Color3.fromRGB(255,255,255), Color3.fromRGB(235,240,255), 45)

local indicatorDot = safeNew("Frame")
indicatorDot.Size = UDim2.new(0, 18, 0, 18)
indicatorDot.Position = UDim2.new(0.5, -9, 0.5, -9)
indicatorDot.BackgroundColor3 = Color3.fromRGB(180,30,30)
makeRound(indicatorDot, 50)
safeParent(indicatorDot, mainIndicator)

-- ======= AIMBOT CIRCLE (Text-only) =======
local aimbotCircle = safeNew("TextButton")
aimbotCircle.Name = "AimbotCircle"
aimbotCircle.Size = UDim2.new(0, 70, 0, 70)
aimbotCircle.Position = UDim2.new(0.5, -35, 0.5, -35)
aimbotCircle.AnchorPoint = Vector2.new(0.5,0.5)
aimbotCircle.Text = "AIMBOT"
aimbotCircle.Font = Enum.Font.GothamBold
aimbotCircle.TextSize = 14
applyTextStyle(aimbotCircle, 14, true)
aimbotCircle.BackgroundTransparency = 0
safeParent(aimbotCircle, mainFrame)
makeRound(aimbotCircle, 35); addStroke(aimbotCircle, 1); addGradient(aimbotCircle, Color3.fromRGB(255,140,80), Color3.fromRGB(220,80,40), 0)

-- ======= SETTINGS PANEL (Clean & Compact) =======
local settingsFrame = safeNew("Frame")
settingsFrame.Name = "SettingsPanel"
settingsFrame.Size = UDim2.new(0, 300, 0, 120)
settingsFrame.Position = UDim2.new(0.5, -150, 0.25, 0)
settingsFrame.AnchorPoint = Vector2.new(0.5,0)
settingsFrame.BackgroundTransparency = 0
settingsFrame.Visible = false
safeParent(settingsFrame, gui)
makeRound(settingsFrame, 12); addStroke(settingsFrame, 1); addGradient(settingsFrame, Color3.fromRGB(235,245,255), Color3.fromRGB(210,225,240), 90)

local sTitle = safeNew("TextLabel"); sTitle.Size = UDim2.new(1, -16, 0, 30); sTitle.Position = UDim2.new(0, 8, 0, 6); sTitle.Text = "Settings"; applyTextStyle(sTitle, 16, true); safeParent(sTitle, settingsFrame)

-- neat rows inside settings
local function mkRow(y)
    local row = safeNew("Frame"); row.Size = UDim2.new(1, -16, 0, 34); row.Position = UDim2.new(0, 8, 0, y); row.BackgroundTransparency = 1; safeParent(row, settingsFrame); return row end

-- prediction toggle pill
local function makePillToggle(parent, label, default, onChange, posY)
    local row = mkRow(posY)
    local pill = safeNew("Frame"); pill.Size = UDim2.new(0.62, 0, 1, 0); pill.Position = UDim2.new(0, 0, 0, 0); pill.BackgroundTransparency = 0; pill.BackgroundColor3 = Color3.fromRGB(40,40,50); makeRound(pill, 14); addStroke(pill,1); safeParent(pill, row)
    local txt = safeNew("TextLabel"); txt.Size = UDim2.new(0.65, 0, 1, 0); txt.Position = UDim2.new(0, 8, 0, 0); txt.Text = label; applyTextStyle(txt, 14, false); txt.TextXAlignment = Enum.TextXAlignment.Left; safeParent(txt, pill)
    local toggle = safeNew("TextButton"); toggle.Size = UDim2.new(0.33, -8, 0, 22); toggle.Position = UDim2.new(0.67, 0, 0.1, 0); toggle.Text = default and "ON" or "OFF"; applyTextStyle(toggle, 12, true); safeParent(toggle, pill); makeRound(toggle,10); addStroke(toggle,1); addGradient(toggle, Color3.fromRGB(120,220,120), Color3.fromRGB(40,180,80), 0)
    toggle.MouseButton1Click:Connect(function()
        if clickSound then clickSound:Play() end
        local v = toggle.Text == "ON"; v = not v; toggle.Text = v and "ON" or "OFF"; if onChange then pcall(onChange, v) end
    end)
    return row
end

-- smoothing slider row (compact)
local function makeSlider(parent, label, default, posY)
    local row = mkRow(posY)
    local txt = safeNew("TextLabel"); txt.Size = UDim2.new(0.62,0,1,0); txt.Position = UDim2.new(0,0,0,0); txt.Text = label .. ": " .. string.format("%.2f", default); applyTextStyle(txt, 14, false); safeParent(txt, row)
    local minus = safeNew("TextButton"); minus.Size = UDim2.new(0,26,0,24); minus.Position = UDim2.new(0.62, 8, 0, 5); minus.Text = "-"; applyTextStyle(minus, 16, true); safeParent(minus, row); makeRound(minus,6); addStroke(minus,1)
    local plus = safeNew("TextButton"); plus.Size = UDim2.new(0,26,0,24); plus.Position = UDim2.new(0.86,8,0,5); plus.Text = "+"; applyTextStyle(plus, 16, true); safeParent(plus, row); makeRound(plus,6); addStroke(plus,1)
    local value = default
    local function update(v) value = math.clamp(v, 0, 1); txt.Text = label .. ": " .. string.format("%.2f", value); CFG.SMOOTHING = value end
    minus.MouseButton1Click:Connect(function() if settingsFrame.Visible then update(value - 0.05); if clickSound then clickSound:Play() end end)
    plus.MouseButton1Click:Connect(function() if settingsFrame.Visible then update(value + 0.05); if clickSound then clickSound:Play() end end)
    update(default)
    return row
end

-- Minimal settings content
makePillToggle(settingsFrame, "Prediction (On/Off)", CFG.USE_PREDICTION, function(v) CFG.USE_PREDICTION = v end, 40)
makeSlider(settingsFrame, "Aim Smoothing", CFG.SMOOTHING, 84)

-- Spawn point buttons (compact)
local spawnSetBtn = safeNew("TextButton"); spawnSetBtn.Size = UDim2.new(0.46, -12, 0, 30); spawnSetBtn.Position = UDim2.new(0.02, 8, 0, 84); spawnSetBtn.Text = "Set Spawn"; applyTextStyle(spawnSetBtn, 14, true); safeParent(spawnSetBtn, settingsFrame); makeRound(spawnSetBtn,8); addStroke(spawnSetBtn,1); addGradient(spawnSetBtn, Color3.fromRGB(255,120,120), Color3.fromRGB(200,80,80), 0)
local spawnTPBtn  = safeNew("TextButton"); spawnTPBtn.Size = UDim2.new(0.46, -12, 0, 30); spawnTPBtn.Position = UDim2.new(0.5, 8, 0, 84); spawnTPBtn.Text = "Teleport to Spawn"; applyTextStyle(spawnTPBtn, 14, true); safeParent(spawnTPBtn, settingsFrame); makeRound(spawnTPBtn,8); addStroke(spawnTPBtn,1); addGradient(spawnTPBtn, Color3.fromRGB(120,200,255), Color3.fromRGB(60,140,220), 0)

-- Settings open/close animation
settingsBtn.MouseButton1Click:Connect(function()
    if clickSound then clickSound:Play() end
    if settingsFrame.Visible then
        tween(settingsFrame, {Position = UDim2.new(0.5, -150, 0.2, -40), Size = UDim2.new(0,300,0,120)}, 0.12)
        tween(settingsFrame, {Position = UDim2.new(0.5, -150, 0.5, 0), Size = UDim2.new(0,0,0,0)}, 0.18)
        task.delay(0.18, function() settingsFrame.Visible = false end)
    else
        settingsFrame.Position = UDim2.new(0.5, -150, 0.5, 40)
        settingsFrame.Size = UDim2.new(0,0,0,0)
        settingsFrame.Visible = true
        tween(settingsFrame, {Position = UDim2.new(0.5, -150, 0.25, 0), Size = UDim2.new(0,300,0,120)}, 0.22)
    end
end)

-- Toggle aim via aimbotCircle or key (V)
aimbotCircle.MouseButton1Click:Connect(function()
    aiming = not aiming; targetPart = nil; targetHRP = nil
    if clickSound then clickSound:Play() end
    indicatorDot.BackgroundColor3 = aiming and Color3.fromRGB(20,220,100) or Color3.fromRGB(180,30,30)
end)

UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.V then
        aiming = not aiming; targetPart = nil; targetHRP = nil
        if clickSound then clickSound:Play() end
        indicatorDot.BackgroundColor3 = aiming and Color3.fromRGB(20,220,100) or Color3.fromRGB(180,30,30)
    end
end)

-- ======= TARGETING HELPERS =======
local function isRealPlayer(plr)
    if not plr or plr == LocalPlayer then return false end
    local ch = plr.Character
    if not ch then return false end
    local hum = ch:FindFirstChildWhichIsA("Humanoid")
    if not hum or hum.Health <= 0 then return false end
    return true
end

local function pickBest()
    local bestPart, bestHRP
    for _, plr in ipairs(Players:GetPlayers()) do
        if isRealPlayer(plr) then
            local ch = plr.Character
            local prt = ch and (ch:FindFirstChild(CFG.LOCK_PART) or ch:FindFirstChild("HumanoidRootPart"))
            local hrp = ch and ch:FindFirstChild("HumanoidRootPart")
            if prt and hrp then
                bestPart, bestHRP = prt, hrp
                break -- Just pick the first valid one, no complex FOV
            end
        end
    end
    targetPart = bestPart; targetHRP = bestHRP; return targetPart
end

local function aimAt(pos)
    local origin = Camera.CFrame.Position
    if CFG.USE_CAM_HEIGHT then origin = origin + Vector3.new(0, CFG.CAM_HEIGHT, 0) end
    local desired = CFrame.new(origin, pos) * CFrame.Angles(math.rad(CFG.SCREEN_TILT), 0, 0)
    if CFG.AIM_MODE == "Snap" or CFG.SMOOTHING <= 0 then
        pcall(function() Camera.CFrame = desired end)
    else
        local cur = Camera.CFrame; local alpha = math.clamp(CFG.SMOOTHING, 0, 1); local nextCF = cur:Lerp(desired, alpha)
        pcall(function() Camera.CFrame = nextCF end)
    end
end

-- ======= RENDER LOOP =======
RunService.RenderStepped:Connect(function()
    if aiming then
        if not targetPart or not targetHRP then pickBest() end
        if targetPart and targetHRP then
            aimAt(targetPart.Position)
        end
    end
end)

-- ======= SPAWN POINT SYSTEM =======
local function placeSpawnMarker(cframe)
    if spawnMarker and spawnMarker.Parent then spawnMarker:Destroy(); spawnMarker = nil end
    local mark = Instance.new("Part")
    mark.Name = "MerebennieSpawnMarker"
    mark.Size = CFG.SPAWN_MARKER_SIZE
    mark.Anchored = true
    mark.CanCollide = false
    mark.Material = Enum.Material.Neon
    mark.Color = Color3.fromRGB(220,40,40)
    mark.CFrame = cframe * CFrame.new(0, CFG.SPAWN_MARKER_SIZE.Y/2, 0)
    safeParent(mark, Workspace)
    spawnMarker = mark
end

local function setSpawnPointAtPlayer()
    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
    if not hrp then return end
    spawnPointCFrame = CFrame.new(hrp.Position)
    placeSpawnMarker(spawnPointCFrame)
end

local function teleportToSpawnPoint()
    if not spawnPointCFrame then return end
    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
    if not hrp then return end
    hrp.CFrame = spawnPointCFrame + Vector3.new(0, 3, 0)
end

spawnSetBtn.MouseButton1Click:Connect(function()
    if clickSound then clickSound:Play() end
    setSpawnPointAtPlayer()
end)
spawnTPBtn.MouseButton1Click:Connect(function()
    if clickSound then clickSound:Play() end
    teleportToSpawnPoint()
end)

print("[DeltaAim] Merebennie Build loaded (No FOV, No FPS Booster, UI Only).")